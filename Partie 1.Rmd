---
title: "Partie 1"
author: "Arthrite, Jeannot et Acétaminophène"
date: "2025-04-11"
output: html_document
---

# **Partie 1 : Reproduction du modèle de l'article**

## **Introduction**

Les récifs coralliens sont grandement affecté par des perturbations
anthropique mettant en péril leur survie. Bien qu'il existe déjà
plusieurs modèles sur la dynamique démographique applicables à plusieurs
populations coralliennes, ceux-ci ne prennent généralement en compte que
la naissance, la mortalité et la croissance.

L'équipe de recherche de Torres et al. ce sont toutefois intéressé sur
les facteurs influencant cette dynamique démographique. Ainsi, ils ont
pris les choses en main pour créer un modèle qui pourrait expliquer les
importance relatives associées à la reproduction asexuée ainsi qu'au
recrutement des larves pélagiques de corail en provenance locale ou
externe qui pourrait être utiliser sur des communautés de populations
hétérogènes et fragmentées.

L'étude (2010 à 2018) est basée sur l'évolution de deux populations
(LTER1 et LTER2) de la côte nord du récif corallien de Moorea en
Polynésie française. suite à une diminution presque complète du récif en
2010 après une attaque des étoiles de mers à épines, suivit d'une hausse
rapide de l'abondance de corail.

------------------------------------------------------------------------

## **Question biologique**

Quelle est l'importance relative de la croissance asexuée et du
recrutement de larves provenant de trois sources spatialement
différentes (allochtone, locale et autochtone) sur la croissance des
sous-populations coraliennes de Pocillopora spp. d'avant-récif et
d'apprès-récif, de la métapopulation du récif coralien Moorea en
Polynésie française, entre 2010 et 2019, suite à un déclin important de
leur abondance?

------------------------------------------------------------------------

## **Hypothèses**

Hypothèse 1: La croissance de la population est influencée par la
croissance asexuée des individus matures déjà présent dans la
sous-population.

Hypothèse 2: La croissance de la population est influencée par la
reproduction sexuée du au recrutement de larves de provenance
autochtone, c'est-à-dire située à 1-100m de la sous-population.

Hypothèse 3: La croissance de la population est influencée par la
reproduction sexuée du au recrutement de larves de provenance locale,
c'est-à-dire située à 100m - 10km de la sous-population (sous-population
à proximité).

Hypothèse 4: La croissance de la population est influencée par la
reproduction sexuée du au recrutement de larves de provenance
allochtone, c'est-à-dire situées à 10-100km de la sous-population
(sous-population non observé dans la recherche).

------------------------------------------------------------------------

## **Données ou informations pertinentes**

**Données utilisées**

Les données empiriques utilisées liées au genre Pocillopora spp. du
récif corallien Moorea en Polynésie française ont été récolté dans le
cadre d'un projet de séries chronologiques écologiques à long terme du
récif corallien Moorea (MCR LTER).

L'étude se concentre sur les événements survenus sur la côte nord entre
2010 et 2018, puisque c'est à cet endroit qu'il y a eu la regénérescence
la plus rapide dans dans le récif.

Certains paramètres de l'étude ont été estimé à partir de données
recueillis sur divers sites et études:

-   La valeur de fécondité est une moyenne normalisé de plusieurs
    données d'études fait sur le genre Pocillopora spp. dans plusieurs
    récifs coralliens (Maldives, Hawaï et la mer Rouge).

-   L'estimation du substrats durs disponibles dans les sous-populations
    ont été estimé à partir d'images de Google Earth analysées sur le
    logiciel ImageJ
    
<br>
<br>

**Organigramme du modèle général des populations**

![](Organigrame.png)

<br>

| symboles | Noms des paramètres |
|:--------------------:|:------------------------------------------------:|
| ra | Croissance asexuée |
| Au | Recrutement autochtone (comprend $\sigma$, $f$, $\zeta$, $\gamma$, $\beta$ de la population receveuse) |
| L | Recrutement local (comprend $\sigma$, $f$, $\zeta$, $\gamma$, $\beta$ de la population donneuse) |
| I | Recrutement allochtone |

------------------------------------------------------------------------

## **Méthode**

**Modèle de cas-limite**

Afin de calculer d' limites et intermédiaire d'une population, voici le
modèle utilisé:

$$\frac{dP^*_1}{d\tau} = (P^*_1 + P^*_2 + \frac{I^*}{\Gamma} )(1-P^*_1) $$

<br>

L'équation permet d'évaluer la proportion de la croissance de la
populaion normalisé (dP\*~1~) sur un échelle de temps intrinsèque
(d$\tau$) en utilisant les paramètres suivants:

<br>

| symboles |                  Noms des paramètres                   |
|:--------:|:------------------------------------------------------:|
|  P\*~1~  |          Taille normalisée de la population 1          |
|  P\*~2~  |          Taille normalisée de la population 2          |
|   I\*    |              Immigration nette normalisée              |
| $\Gamma$ | Croissance net du processus asexuel et de la mortalité |
|  $\tau$  |             Temps intrinsèque (en années)              |


<br>
<br>

Chacun de ses paramètres peut déterminés à partir des équestion
suivantes:

*Taille normalisée de la population 1:* $$P^*_1 = \frac{P_1}{K_1}$$

*Taille normalisée de la populatioin 2:* $$P^*_2 = \frac{P_2}{K_2}$$

*Immigration nette normalisés:* $$I^* = \frac{I}{SK}$$

*Croissance nette du processus asexuel et de la mortalité de la
population:* $$\Gamma = \frac{R}{S}$$

*Temps intrinsèque:* $$\tau = Rt$$

<br>

| symboles |                    Noms des paramètres                    |
|:--------:|:---------------------------------------------------------:|
|    P     |                  Taille de la population                  |
|    K     |           Capacité de soutien de la population            |
|    I     |                     Immigration nette                     |
|    S     |            Temps caractéristique d'immigration            |
|    R     | Reproduction (reproduction asexuée + reproduction sexuée) |
|   $t$    |                     Temps (en années)                     |

<br>
<br>

**Modèle des sous-populations**

Le modèle dynamique des sous-populations comprend deux équations, soit
une équation pour chaque sous-population d'un récif (avant-récif et
après-récif).

<br>

*Croissance de sous-population avant-récif (P~f~)*

$$\frac{dP_f}{dt} = ([P_f (r_f + \sigma f \zeta ( \gamma \beta )_{f \rightarrow f} )] + [P_b(\sigma f \zeta ( \gamma \beta ) _{b \rightarrow f )})] + I_f) ( 1 - \frac{P_f}{Kf} )$$

<br>

*Croissance de sous-population arrière-récif (P~b~)*

$$\frac{dP_b}{dt} = ( [P_b (r_b + \sigma f \zeta ( \gamma \beta )_{b \rightarrow b} )] + [P_f (\sigma f \zeta ( \gamma \beta ) _{f \rightarrow b )}) ] + I_b) ( 1 - \frac{P_b}{Kb} )$$

<br>

Les variables utilisées dans les équations sont les suivantes:

| symboles |                    Noms des paramètres                    |
|:--------:|:---------------------------------------------------------:|
|    P     |                  Taille de la population                  |
|    I     |                     Immigration nette                     |
|    K     |                    Capacité de soutien                    |
|    r     | Prolifération et mortalité asexuée (reproduction asexuée) |
| $\sigma$ |               Classe de taille des recrues                |
|   $f$    |                         Fécondité                         |
| $\zeta$  |            Probabilité de maturation larvaire             |
| $\gamma$ |                    Dispersion larvaire                    |
| $\beta$  |                Probabilité de recrutement                 |

Les indices $b$ et $f$ représentent respectivement les sous-populations
d'arrière-récif et d'avant-récif.

La fécondité ($f$), la probabilité de maturation larvaire ($\zeta$), la
dispersion larvaire ($\gamma$), la probabilité de recrutement ($\beta$)
et la classe de taille des recrues ($\sigma$) influencent l'ampleur de
la reproduction sexuée par recrutement ($r_e$).

------------------------------------------------------------------------

## **Suppositions**

*Données*

La capacité de soutien est déterminé par une combinaison de facteurs
locaux tels que la prédation, les maladie et la compétition.

Selon les différentes études, environ la moitié des oeufs sont fécondés
et viables.

<br>

*Modèles de cas limites*

Pour le modèle des cas-limites, sont considère que le taux de croissance $r$ est identique dans le deux population (r1=r2=1), tout comme la capacité de soutien (K1=K2=1).

<br>

*Modèles de croissance des sous-populations*

L'utilisation d'un modèle adimensionnel (modèle dynamique de croissance
des sous-populations) permet de prendre en compte simultanément la
croissance asexuée individuelle et la croissance induite par le
recrutement, sans avoir à modéliser les transitions entre les stades de
vie.

Les sous-populations incluses dans le modèle sont lié à une
métapopulation stable qui permet un apport constante de larves dans une
population locale spécifique, ne permettant donc pas une perte
d'abondance totale dans une sous-population, d'où l'ajout d'une valeur
d'immigration nette (I).

L'avant-récif et l'arrière-récif sont impactés différements par les
perturbations (avant-récif a une couverture plus forte & après-récif est
en forte compétition avec les microalgues), et la dynamique de
rétablissement est non-uniforme entre les sous-populations en fonction
des variations du recrutement coralliens et du succès post-installation.

Tous les paramètres de ce modèle, à l'exception de $P$, sont invariants
dans le temps.

Le substrat dispobible pour la croissance est limité.

Il ne peut y avoir plus de recrues issues des populations locales que le
nombre de larves disponibles dans ces populations, tout comme il ne peut
pas y avoir plus de recrues qui parviennent à maturité que le nombre de
larve disponibles ($\beta$\<=1).

Les facteurs intrinsèques à une sous-population dépendent de la densité
de celle-ci.

------------------------------------------------------------------------

## **Calculs et implémentation en R**

### Script de cas limites et intermédiaire (reproduction de la figure 2)

```{r, warning=FALSE, message=FALSE}
# ALLER CHERCHER LES PACKAGES NÉCESSAIRES
library(deSolve)
library(ggplot2)


# DÉFINITION DES PARAMÈTRES DU MODÈLE
#Paramètres du modèle (Gamma [taux de regénération intrinsèque] pas inclus, car il a plusieurs valeur)
parameters <- list(K = 1,     #Capacité de soutien
                   I = 1)     #Immigration nette

#Conditions initiales (ces conditions sont les mêmes que dans le graphique de l'article)
state <- c(P_auto = 0.01,     #Population autochtone
           P_allo = 0.01)     #Population allochtone

#Temps de simulation
times <- seq(0, 5, by = 0.1)


# CRÉATION DU MODÈLE DE CAS LIMITES
model_cas_limite <- function(t, state, parameters) {
  #Objet des paramètres utilisés
  P_auto <- state[1]
  P_allo <- state[2]
  K <- parameters$K
  I <- parameters$I
  Gamma <- parameters$Gamma
  
  #Normalisation des paramètres par la capacité de soutien
  P_auto_norm <- P_auto / K
  P_allo_norm <- P_allo / K
  
  
  #Équations différentielles du modèle, basées sur les équations 3 de l'article
  #On additionne les deux populations pour le facteur de densité-dépendance pour que notre échelle des y soit sur 1, et non 2
  
  #Croissance normalisée de la population du au recrutement autochtone
  dP_auto <- (P_auto_norm + P_allo_norm + I/Gamma) * (1 - (P_auto_norm + P_allo_norm))  
  
  #Croissance normalisée de la population du au recrutement allochtone
  #On prend seulement I/Gamma, car cette population est seulement immigratrice
  dP_allo <- I/Gamma * (1 - (P_auto_norm + P_allo_norm))  
  
  list(c(dP_auto, dP_allo))
}


# RÉSOLUTION NUMÉRIQUE DU MODÈLE

#Résoudre l'ODE pour différents Gamma

#Cas intermédiaire
parameters$Gamma <- 10
out_intermediate <- ode(y = state, times = times, func = model_cas_limite, parms = parameters)


#Immigration dominante (Γ → 0)
parameters$Gamma <- 0.1
out_immigration <- ode(y = state, times = times, func = model_cas_limite, parms = parameters)


#Croissance intrinsèque dominante (Γ → ∞)
parameters$Gamma <- 100
out_intrinsic <- ode(y = state, times = times, func = model_cas_limite, parms = parameters)

#Convertir les résultats en dataframes
df_intermediate <- as.data.frame(out_intermediate)
df_immigration <- as.data.frame(out_immigration)
df_intrinsic <- as.data.frame(out_intrinsic)

#Calculer la population totale
df_intermediate$Total <- df_intermediate$P_auto + df_intermediate$P_allo
df_intrinsic$Total <- df_intrinsic$P_auto + df_intrinsic$P_allo
df_immigration$Total <- df_immigration$P_auto + df_immigration$P_allo




# GRAPHIQUE
#Tracer la figure avec inversion des couleurs des lignes pleines
ggplot() +
  #Courbes en pointillés pour les cas limites (pas modifiées)
  geom_line(data = df_intrinsic, aes(x = time, y = Total, color = "Γ → ∞"), linetype = "dashed", size = 1) +
  geom_line(data = df_immigration, aes(x = time, y = Total, color = "Γ → 0"), linetype = "dashed", size = 1) +
  
  #Courbes solides pour Γ = 10 
  geom_line(data = df_intermediate, aes(x = time, y = Total, color = "Total"), size = 1) +
  geom_line(data = df_intermediate, aes(x = time, y = P_allo, color = "Autochtone"), size = 1) +  
  geom_line(data = df_intermediate, aes(x = time, y = P_auto, color = "Allochtone"), size = 1) +  
  
  #Définition des titres
  labs(
    title = "Trajectoires adimensionnelle du rétablissement d'une population",
    x = "Time (τ)", 
    y = expression(P^"*"), 
    color = NULL
  ) +
  
  #Définition des couleurs
  scale_color_manual(values = c(
    "Γ → ∞" = "steelblue", 
    "Γ → 0" = "goldenrod", 
    "Total" = "black", 
    "Allochtone" = "goldenrod", 
    "Autochtone" = "steelblue"
  )) +
  
  theme_minimal() +
  
  #Ajustement de certains paramètres visuels
  theme(
    legend.position = c(0.8, 0.5),
    legend.justification = c("left","top"),    
    legend.text = element_text(size = 16),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    axis.ticks = element_line(color = "black"),
    axis.ticks.length = unit(5, "pt"),
    plot.title = element_text(hjust = 0.5),
    plot.margin = margin(10, 50, 10, 10)
  ) +
  
  #Aligner l'axe des x avec le 0 de l'axe des y
  coord_cartesian(expand = FALSE)

```

<br>
<br>

### Script de la croissance de la sous-population avant-récif (reproduction de la figure 3a)

```{r, warning=FALSE, message=FALSE}
# ALLER CHERCHER LES PACKAGES NÉCESSAIRES
library(deSolve)
library(ggplot2)
library(dplyr)
library(tidyr)


# DÉFINITION DES PARAMÈTRES DU MODÈLE
params <- list(
  
  #Paramètre de reproduction asexuée
  rb = 0.05,        #Reproduction asexuée de la population backreef
  rf = 0.15,        #Reproduction asexuée de la population forereef
  
  
  #Paramètre de reproduction sexuée
  sigma = 0.5,    #Intensité de la croissance larvaire
  fecondity = 1,    #Fécondité
  zeta = 1,         #Probabilité de maturation larvaire
  
  #Coefficients d’interactions (γβ)
  gamma_beta_bb = 0.01,   #Influence de backreef sur backreef
  gamma_beta_fb = 0.002,  #Influence de forereef sur backreef
  gamma_beta_ff = 0.02,   #Influence de forereef sur forereef
  gamma_beta_bf = 0.1,    #Influence de backreef sur forereef
  
  #Paramètre d'immigration nette (apport externe constant)
  Ib = 0.08,   #Immigration du backreef
  If = 0.09,   #Immigration du forereef
  
  #Capacités de soutien en proportion
  Kb = 0.64,   #Capacité de soutien du backreef 0.64 dans article (observé)
  Kf = 0.8     #Capacité de soutien du forereef  0.8 dans article
)

#Conditions initiale du modèle
state <- c(pFallo = 0.01, pFauto = 0.01, pFtotal = 0.01, pBallo = 0.3, pBauto = 0.1, pBtotal = 0.4)

#Intervalle de temps en années (2011 à 2018)
times <- seq(0, 7, by = 0.1)




# CRÉATION DU MODÈLE DE CROISSANCE SELON LES ÉQUATIONS 4 DE L'ARTICLE
model_proportion_forereef <- function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    
    # 1. Séparation de l'équation de la croissance de sous-population avant-récif en 3 équations:
    # Croissance du au recrutement autochtone et à la reproduction asexuée (dFauto/dt)
    dFauto  <- (pFtotal * (rf + (sigma * fecondity * zeta * gamma_beta_ff))) * (1 - pFtotal / Kf)
    
    # Croissance du au recrutement allochtone et l'immigration nette (dFallo/dt)
    dFallo  <- ((pBtotal * (sigma * fecondity * zeta * gamma_beta_bf)) + If) * (1 - pFtotal / Kf)
    
    # Croissance totale de l'avant-récif (dB/dt)
    dFtotal <- dFallo + dFauto
    
    
    #2. Sépration de l'équation de la croissance de sous-population après-récif en 3 équations:
    # Croissance du au recrutement autochtone et à la reproduction asexuée (dBauto/dt)
    dBauto  <- (pBtotal * (rb + (sigma * fecondity * zeta * gamma_beta_bb))) * (1 - pBtotal / Kb)
    
    # Croissance du au recrutement allochtone et l'immigration nette (dBallo/dt)
    dBallo  <- ((pFtotal * (sigma * fecondity * zeta * gamma_beta_fb)) + Ib) * (1 - pBtotal / Kb)
    
    # Croissance totale de l'après-récif (dB/dt)
    dBtotal <- dBallo + dBauto
    
    
    list(c(dFallo, dFauto, dFtotal, dBallo, dBauto, dBtotal))
  })
}



# RÉSOLUTION NUMÉRIQUE DU MODÈLE
out <- ode(y = state, times = times, func = model_proportion_forereef, parms = params)
out <- as.data.frame(out)



# GRAPHIQUE
#Mise en forme pour ggplot
plot_data <- out %>%
  select(time, pFallo,pFauto,pFtotal) %>%
  
  #Renommer les paramètres utilisées
  rename(
    Total = pFtotal,
    Allochtone = pFallo,
    Autochtone = pFauto
  ) %>%
  
  #Mettre en pourcentage les valeurs modélisées
  mutate(
    Total = Total*100,
    Allochtone = Allochtone*100,
    Autochtone = Autochtone*100
  ) %>%
  
  pivot_longer(-time, names_to = "Source", values_to = "Value")


#Graphique
ggplot(plot_data, aes(x = time, y = Value, color = Source)) +
  geom_line(size = 1.7) +
  
  #Définition de l'axe des x
  scale_x_continuous(
    breaks = c(1,3,5,7),
    labels= c(2012, 2014, 2016, 2018)
  ) +
  
  #Définition de l'axe des y
  scale_y_continuous(
    limits=c(0,75),
    breaks = c(0, 25, 50, 75)
  ) +
  
  #Définition des couleurs
  scale_color_manual(
    values = c(
      "Total" = "black",
      "Allochtone" = "goldenrod",
      "Autochtone" = "steelblue"  
    )
  ) +
  
  #Définition des titres
  labs(
    title = "Croissance de la sous-population avant-récif corallienne (Pf)",
    x = NULL,
    y = "Couverture corallienne (%)",
    color = NULL
  ) +
  
  theme_minimal(base_size = 14) +
  
  #Ajustement de certains paramètres visuels
  theme(
    legend.position = c(0.05, 0.95),
    legend.justification = c("left","top"),
    legend.text = element_text(size = 16),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    axis.ticks = element_line(color = "black"),
    axis.ticks.length = unit(5, "pt"),
    plot.title = element_text(hjust = 0.5, size=10),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  
  #Aligner l'axe des x avec le 0 de l'axe des y
  coord_cartesian(expand = FALSE)

```

<br>
<br>

### Script des facteurs de croissance de l'avant-récif (reproduction de la figure 3c)

```{r, warning=FALSE, message=FALSE}
# ALLER CHERCHER LES PACKAGES NÉCESSAIRES
library(ggplot2)
library(dplyr)
library(tidyr)


# DÉFINITION DES PARAMÈTRES UTILISÉS
#Paramètres de temps
years <- 2011:2018   #Années de l'étude
n <- length(years)

#Paramètre de taille de population
Pf <- seq(0.05, 0.6, length.out = n)   #Population forereef
Pb <- seq(0.2, 0.5, length.out = n)    #Population backreef
Pf[1] <- 0                             #Forcer à commencer à 0
Pb[1] <- 0                             #Force à commencer à 0

#Paramètre de capacité de soutien
Kf <- 0.8            #Capacité de charge de 80%

#Paramètres de reproduction
rf <- 0.12           #Reproduction asexuée 
sigma <- 0.05        #Intensité de la croissance larvaire

#Coefficients d'interaction (γβ)
gamma_beta_ff <- seq(0.2, 0.8, length.out = n)   #forereef vers forereef
gamma_beta_bf <- seq(0.01, 0.01, length.out = n) #forereef vers backreef

#Immigration externe (données modélisées)
If <- c(0.0075, 0.0095, 0.0085, 0.008, 0.007, 0.006, 0.005, 0.002)



# CALCUL DES COMPOSANTES dPb/dt ET AJUSTEMENT SELON LE FACTEUR DE DENSITÉ-DÉPENDANCE
#Facteur de densité-dépendance
density_factor <- (1 - Pf / Kf)

#Croissance asexuée
asexual <- Pf * rf
asexual_adj <- asexual * density_factor

#Auto-recrutement (autochtone)
self_recruit <- Pf * sigma * gamma_beta_ff
self_recruit_adj <- self_recruit * density_factor

#Échange local
local_exchange <- Pb * sigma * gamma_beta_bf
local_exchange_adj <- local_exchange * density_factor

#Immigration nette (allochtone)
immigration <- If 
immigration_adj <- immigration * density_factor



# GRAPHIQUE
#Création du dataframe pour le graphique
df <- data.frame(
  Year = rep(years, 4),
  Component = rep(c("Croissance asexuée", "Auto-recrutement", "Échange local", "Immigration"), each = n),
  Value = c(asexual_adj, self_recruit_adj, local_exchange_adj, immigration_adj)
)

#Mise en forme des données en pourcentage de la capacité de charge par an
df$PercentK <- 100 * df$Value / Kf

#Amplification des courbes pour un meilleur effet visuel
scaling_factor <- 2.5

df$PercentK <- df$PercentK * scaling_factor


#Graphique
ggplot(df, aes(x = Year, y = PercentK, linetype = Component)) +
  geom_smooth(se = FALSE, method = "loess", size = 1.2, color = "black") +
  
  #Définition du type de lignes utilisées
  scale_linetype_manual(
    values = c("solid", "dashed", "dotted", "dotdash"),
    breaks = c("Croissance asexuée", "Immigration", "Auto-recrutement", "Échange local")
  ) +
  
  #Définition de l'axe des y
  scale_y_continuous(
    limits = c(0, 11),
    breaks = c(0, 3, 7, 11)
  )+
  
  #Définition des titres
  labs(
    title = "Composants contribuant aux changements de la croissance de la population",
    y = expression("%K / yr"),
    x = NULL,
    linetype = NULL
  ) +
  
  theme_minimal(base_size = 14) +
  
  #Ajustement de certains paramètres visuels
  theme(
    legend.position = c(0.05, 0.95),
    legend.justification = c("left", "top"),
    legend.text = element_text(size = 16),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    axis.ticks = element_line(color = "black"),
    axis.ticks.length = unit(5, "pt"),
    axis.title.y = element_text(angle = 90, vjust = 0.5),
    plot.title = element_text(hjust = 0.4, face = "bold", size = 10),
    plot.margin = margin(10, 30, 10, 10)
  )+
  
  #Aligner l'axe
  coord_cartesian(expan = FALSE)
```

<br>
<br>

### Script de la croissance de la sous-population après-récif (reproduction de la figure 4a)

```{r, warning=FALSE, message=FALSE}
# ALLER CHERCHER LES PACKAGES NÉCESSAIRES
library(deSolve)
library(ggplot2)
library(dplyr)
library(tidyr)


# DÉFINITION DES PARAMÈTRES DU MODÈLE
#Différences: ajout de mortalité et changements états initiaux.

params <- list(
  
  #Taux de mortalité du backreef
  mortal <- 0.3,   
  
  #Paramètre de reproduction asexuée
  rb = 0.05,        #Reproduction asexuée de la population backreef
  rf = 0.15,        #Reproduction asecuée de la population forereef
  
  #Paramètre de reproduction sexuée
  sigma = 0.5,    #Intensité de la croissance larvaire 
  fecondity = 1,    #Fécondité
  zeta = 1,         #Probabilité de maturation larvaire
  
  #Coefficients d’interactions (γβ)
  gamma_beta_bb = 0.01,   #Influence de backreef sur backreef
  gamma_beta_fb = 0.002,  #Influence de forereef sur backreef
  gamma_beta_ff = 0.2,    #Influence de forereef sur forereef 
  gamma_beta_bf = 0.1,    #Influence de backreef sur forereef 
  
  #Paramètre d'immigration nette (apport externe constant)
  Ib = 0.08,     #Immigration du backreef (tiré du graphique 4c)
  If = 0.09,     #Immigration du forereef
  
  #Capacités de soutien en proportion
  Kb = 0.64,   #Capacité de soutien du backreef 0.64 dans article (observé)
  Kf = 0.8     #Capacité de soutien du forereef  0.8 dans article
)

#Conditions initiales du modèle
state <- c(pFallo = 0.01, pFauto = 0.01, pFtotal = 0.01, pBallo = 0.3, pBauto = 0.1, pBtotal = 0.4)

#Intervalle de temps en années (2011 à 2018)
times <- seq(0, 7, by = 0.1)





# CRÉATION DU MODÈLE DE CROISSANCE SELON LES ÉQUATIONS 4 DE L'ARTICLE + MORTALITÉ
model_proportion_backreef <- function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    
    # 1. Séparation de l'équation de la croissance de sous-population avant-récif en 3 équations:
    # Croissance du au recrutement autochtone et à la reproduction asexuée (dFauto/dt)
    dFauto  <- (pFtotal * (rf + (sigma * fecondity * zeta * gamma_beta_ff))) * (1 - pFtotal / Kf)
    
    # Croissance du au recrutement allochtone et l'immigration nette (dFallo/dt)
    dFallo  <- ((pBtotal * (sigma * fecondity * zeta * gamma_beta_bf)) + If) * (1 - pFtotal / Kf)
    
    # Croissance totale de l'avant-récif (dB/dt)
    dFtotal <- dFallo + dFauto
    
    
    #2. Sépration de l'équation de la croissance de sous-population après-récif en 3 équations:
    # Croissance du au recrutement autochtone et à la reproduction asexuée (dBauto/dt)
    dBauto  <- (pBtotal * (rb + (sigma * fecondity * zeta * gamma_beta_bb))) * (1 - pBtotal / Kb)
    
    # Croissance du au recrutement allochtone et l'immigration nette (dBallo/dt)
    dBallo  <- ((pFtotal * (sigma * fecondity * zeta * gamma_beta_fb)) + Ib) * (1 - pBtotal / Kb)
    
    # Croissance totale de l'après-récif (dB/dt)
    # Ajout de la mortalité ici
    dBtotal <- dBallo + dBauto - (mortal * pBtotal)
    
    
    list(c(dFallo, dFauto, dFtotal, dBallo, dBauto, dBtotal))
  })
}



# RÉSOLUTION NUMÉRIQUE DU MODÈLE
out <- ode(y = state, times = times, func = model_proportion_backreef, parms = params)
out <- as.data.frame(out)



# GRAPHIQUE
#Ajustement des données en pourcentage
out$pBtotal_pourcentage <- out$pBtotal*100

#graphique qui reproduit la figure 4a
ggplot(out, aes(x = time, y = pBtotal_pourcentage)) +
  geom_line(size = 1.7) +
  
  #Définition de l'axe des x
  scale_x_continuous(
    breaks = c(1,3,5,7),
    labels= c(2012, 2014, 2016, 2018)
  ) +
  
  #Définition de l'axe des y
  scale_y_continuous(
    limits=c(0,50),
    breaks = c(0, 20, 50)
  ) +
  
  #Définition des titres
  labs(
    title = "Couverture corallienne de la sous-population après-récif (Pb)",
    x = NULL,
    y = "Couverture corallienne (%)"
  ) +
  
  theme_minimal(base_size = 14) +
  
  #Ajustement de certains paramètres visuels
  theme(
    legend.position = c(0.80, 0.95),
    legend.justification = c("left","top"),    
    legend.text = element_text(size = 16),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    axis.ticks = element_line(color = "black"),
    axis.ticks.length = unit(5, "pt"),
    plot.title = element_text(hjust = 0.5, size=10),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  
  #Aligner l'axe des x avec le 0 de l'axe des y
  coord_cartesian(expand = FALSE)

```

<br>
<br>
 
### Script des facteurs de croissance de l'après-récif (reproduction de la figure 4c)

```{r, warning=FALSE, message=FALSE}
# ALLER CHERCHER LES PACKAGES NÉCESSAIRES
library(ggplot2)
library(dplyr)
library(tidyr)

# DÉFINITION DES PARAMÈTRES UTILISÉS

#Paramètres de temps
years <- 2011:2018   #Années de l'étude
n <- length(years)

# Paramètres de taille de population
Pf <- seq(0.05, 0.6, length.out = n)  #Population forereef
Pb <- seq(0.2, 0.5, length.out = n)   #Population backreef
Pf[1] <- 0                            #Forcer à commencer à 0
Pb[1] <- 0                            #Forcer à commencer à 0

#Paramètre de capacité de soutien
Kb <- 0.8            #Capacité de charge de 80%

#Paramètres de reproduction
rb <- 0.1            #Reproduction asexuée
sigma <- 0.05        #Intensité de la croissance larvaire

#Coefficients d'interaction (γβ)
gamma_beta_bb <- seq(0.2, 0.7, length.out = n)  #backreef vers backreef
gamma_beta_fb <- rep(0.01, lenght.out = n)      #forereef vers backreef



# CALCUL DES COMPOSANTES dPb/dt ET AJUSTEMENT SELON LE FACTEUR DE DENSITÉ-DÉPENDANCE
#Facteur de densité-dépendance
density_factor <- (1 - Pb / Kb)

#Croissance asexuée et auto-recrutement (autochtone)
intrinsic <- Pb * (rb + sigma * gamma_beta_bb)
intrinsic_adj <- intrinsic * density_factor

#Échange local
exchange <- Pf * sigma * gamma_beta_fb
exchange_adj <- exchange * density_factor

#Immigration nette (allochtone)
immigration <- rep(0.0007, n)
immigration_adj <- immigration 

#Variation totale
total_change <- intrinsic_adj + exchange_adj + immigration_adj

#Estimation de la courbe de mortalité
mortalite <- -0.003 + 0.0022 * (years - min(years)) / ((years - min(years)) + 4)



# GRAPHIQUE
#Création du dataframe pour le graphique
df_backreef <- data.frame(
  Year = rep(years, 2),
  Component = rep(c("Immigration", "Mortality"), each = n),
  Value = c(immigration_adj, mortalite)
)


#Mise en forme des données en pourcentage de la capacité de charge par an
df_backreef$PercentKb <- 100 * df_backreef$Value / Kb


#Graphique lissé
ggplot(df_backreef, aes(x = Year, y = PercentKb, linetype = Component)) +
  geom_smooth(se = FALSE, method = "loess", size = 1.2, color = "black") +
  
  #Définition du type de lignes utilisés
  scale_linetype_manual(values = c("Mortality" = "solid", "Immigration" = "dashed")) +
  
  #Définition de l'axe des y
  scale_y_continuous(
    limits = c(-0.4, 0.1),
    breaks = c(-0.4, -0.1, 0.1)
  )+
  
  #Définition des titres
  labs(
    title = "Composants contribuant aux changements de la croissance de la population dans le backreef",
    y = expression("%K / yr"),
    x = NULL,
    linetype = NULL
  ) +
  
  theme_minimal(base_size = 14) +
  
  #Ajustement de certains paramètres visuels
  theme(
    legend.position = c(0.80, 0.20),
    legend.justification = c("left", "top"),
    legend.text = element_text(size = 16),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    axis.ticks = element_line(color = "black"),
    axis.ticks.length = unit(5, "pt"),
    axis.title.y = element_text(angle = 90, vjust = 0.5),
    plot.title = element_text(hjust = 0.5, face = "bold", size = 10),
    plot.margin = margin(10, 30, 10, 10)
  )+
  
  #Aligner l'axe des x avec le 0 de l'axe des y
  coord_cartesian(expan=FALSE)

```

------------------------------------------------------------------------

## **Résultats**

### Cas limites

Le graphique des cas limites et intermédiaires représente des trajectoires de rétablissement de populations de coraux lorsque les deux sous-populations sont supposés identiques, donc que leur abondance initiales sont de P1=P2=1, que K1=K2=1 et que r1=r2=1. Ainsi, lorsque les paramètres sont invariants dans le temps la taille de la population devrait être relié à différents facteurs selon la croissance nette ($\Gamma$).

Lorsque $\Gamma$ = 0, le recrutement de larve allochtone devrait avoir un plus grand impact sur la croissance, en faisant augmenter la taille de la population très rapidement avant de s'immobiliser seuil K.

Lorsque $\Gamma$ = Infinie, c'est plutôt le recrutement de larve autochtone qui domine.

Lorsque $\Gamma$ = 10, donc dans un cas intermédiaire, les deux types de recrutement larvaire sont observés, quoiqu'il y ait tout de même un recrutement pour les larves allochtones plus fort que pour les larves autochtones.



![](Figure 2.png) 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
# ALLER CHERCHER LES PACKAGES NÉCESSAIRES
library(deSolve)
library(ggplot2)


# DÉFINITION DES PARAMÈTRES DU MODÈLE
#Paramètres du modèle (Gamma [taux de regénération intrinsèque] pas inclus, car il a plusieurs valeur)
parameters <- list(K = 1,     #Capacité de soutien
                   I = 1)     #Immigration nette

#Conditions initiales (ces conditions sont les mêmes que dans le graphique de l'article)
state <- c(P_auto = 0.01,     #Population autochtone
           P_allo = 0.01)     #Population allochtone

#Temps de simulation
times <- seq(0, 5, by = 0.1)


# CRÉATION DU MODÈLE DE CAS LIMITES
model_cas_limite <- function(t, state, parameters) {
  #Objet des paramètres utilisés
  P_auto <- state[1]
  P_allo <- state[2]
  K <- parameters$K
  I <- parameters$I
  Gamma <- parameters$Gamma
  
  #Normalisation des paramètres par la capacité de soutien
  P_auto_norm <- P_auto / K
  P_allo_norm <- P_allo / K
  
  
  #Équations différentielles du modèle, basées sur les équations 3 de l'article
  #On additionne les deux populations pour le facteur de densité-dépendance pour que notre échelle des y soit sur 1, et non 2
  
  #Croissance normalisée de la population du au recrutement autochtone
  dP_auto <- (P_auto_norm + P_allo_norm + I/Gamma) * (1 - (P_auto_norm + P_allo_norm))  
  
  #Croissance normalisée de la population du au recrutement allochtone
  #On prend seulement I/Gamma, car cette population est seulement immigratrice
  dP_allo <- I/Gamma * (1 - (P_auto_norm + P_allo_norm))  
  
  list(c(dP_auto, dP_allo))
}


# RÉSOLUTION NUMÉRIQUE DU MODÈLE

#Résoudre l'ODE pour différents Gamma

#Cas intermédiaire
parameters$Gamma <- 10
out_intermediate <- ode(y = state, times = times, func = model_cas_limite, parms = parameters)


#Immigration dominante (Γ → 0)
parameters$Gamma <- 0.1
out_immigration <- ode(y = state, times = times, func = model_cas_limite, parms = parameters)


#Croissance intrinsèque dominante (Γ → ∞)
parameters$Gamma <- 100
out_intrinsic <- ode(y = state, times = times, func = model_cas_limite, parms = parameters)

#Convertir les résultats en dataframes
df_intermediate <- as.data.frame(out_intermediate)
df_immigration <- as.data.frame(out_immigration)
df_intrinsic <- as.data.frame(out_intrinsic)

#Calculer la population totale
df_intermediate$Total <- df_intermediate$P_auto + df_intermediate$P_allo
df_intrinsic$Total <- df_intrinsic$P_auto + df_intrinsic$P_allo
df_immigration$Total <- df_immigration$P_auto + df_immigration$P_allo




# GRAPHIQUE
#Tracer la figure avec inversion des couleurs des lignes pleines
ggplot() +
  #Courbes en pointillés pour les cas limites (pas modifiées)
  geom_line(data = df_intrinsic, aes(x = time, y = Total, color = "Γ → ∞"), linetype = "dashed", size = 1) +
  geom_line(data = df_immigration, aes(x = time, y = Total, color = "Γ → 0"), linetype = "dashed", size = 1) +
  
  #Courbes solides pour Γ = 10 
  geom_line(data = df_intermediate, aes(x = time, y = Total, color = "Total"), size = 1) +
  geom_line(data = df_intermediate, aes(x = time, y = P_allo, color = "Autochtone"), size = 1) +  
  geom_line(data = df_intermediate, aes(x = time, y = P_auto, color = "Allochtone"), size = 1) +  
  
  #Définition des titres
  labs(
    title = "Trajectoires adimensionnelle du rétablissement d'une population",
    x = "Time (τ)", 
    y = expression(P^"*"), 
    color = NULL
  ) +
  
  #Définition des couleurs
  scale_color_manual(values = c(
    "Γ → ∞" = "steelblue", 
    "Γ → 0" = "goldenrod", 
    "Total" = "black", 
    "Allochtone" = "goldenrod", 
    "Autochtone" = "steelblue"
  )) +
  
  theme_minimal() +
  
  #Ajustement de certains paramètres visuels
  theme(
    legend.position = c(0.8, 0.5),
    legend.justification = c("left","top"),    
    legend.text = element_text(size = 16),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    axis.ticks = element_line(color = "black"),
    axis.ticks.length = unit(5, "pt"),
    plot.title = element_text(hjust = 0.5),
    plot.margin = margin(10, 50, 10, 10)
  ) +
  
  #Aligner l'axe des x avec le 0 de l'axe des y
  coord_cartesian(expand = FALSE)

```

<br>

### Avant-récif

Pour le cas d'une sous-population d'avant-récif qui est très efficace pour se rétablir après une perturbation forte, le modèle `model_proportion_forereef` a permis d'évaluer la dynamique d'un récif corallien qui croît grâce à différentes sources larvaires. Dans ce cas, on observe que le pourcentage de recouvrement en corail du subtrat est principalement du au recrutement larvaire des sous-populations autres, grâce à l'immigration via l'après-récif et d'ailleurs.

Toutefois, le graphique du pourcentage de la capacité de charge des populations par an permet d'évaluer la contribution de chaque facteurs de croissance pendant le rétablissement de la sous-population. Pour ce qui est de l'appart extérieur, on remarque alors que les échanges locaux, donc entre l'avant et l'après-récif, ont très peu d'impact, contrairement à l'immigration nette qui est le plus important directement après la perturbation. Pour ce qui est de l'appart intrinsèque, la croissance asexuelle et l'auto-recrutement en larves dominent les autres facteurs contribuant 2 à 3 ans après la perturbation.

<br>

![](Figure 3a.png)
```{r, echo=FALSE}
# ALLER CHERCHER LES PACKAGES NÉCESSAIRES
library(deSolve)
library(ggplot2)
library(dplyr)
library(tidyr)


# DÉFINITION DES PARAMÈTRES DU MODÈLE
params <- list(
  
  #Paramètre de reproduction asexuée
  rb = 0.05,        #Reproduction asexuée de la population backreef
  rf = 0.15,        #Reproduction asexuée de la population forereef
  
  
  #Paramètre de reproduction sexuée
  sigma = 0.5,    #Intensité de la croissance larvaire
  fecondity = 1,    #Fécondité
  zeta = 1,         #Probabilité de maturation larvaire
  
  #Coefficients d’interactions (γβ)
  gamma_beta_bb = 0.01,   #Influence de backreef sur backreef
  gamma_beta_fb = 0.002,  #Influence de forereef sur backreef
  gamma_beta_ff = 0.02,   #Influence de forereef sur forereef
  gamma_beta_bf = 0.1,    #Influence de backreef sur forereef
  
  #Paramètre d'immigration nette (apport externe constant)
  Ib = 0.08,   #Immigration du backreef
  If = 0.09,   #Immigration du forereef
  
  #Capacités de soutien en proportion
  Kb = 0.64,   #Capacité de soutien du backreef 0.64 dans article (observé)
  Kf = 0.8     #Capacité de soutien du forereef  0.8 dans article
)

#Conditions initiale du modèle
state <- c(pFallo = 0.01, pFauto = 0.01, pFtotal = 0.01, pBallo = 0.3, pBauto = 0.1, pBtotal = 0.4)

#Intervalle de temps en années (2011 à 2018)
times <- seq(0, 7, by = 0.1)




# CRÉATION DU MODÈLE DE CROISSANCE SELON LES ÉQUATIONS 4 DE L'ARTICLE
model_proportion_forereef <- function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    
    # 1. Séparation de l'équation de la croissance de sous-population avant-récif en 3 équations:
    # Croissance du au recrutement autochtone et à la reproduction asexuée (dFauto/dt)
    dFauto  <- (pFtotal * (rf + (sigma * fecondity * zeta * gamma_beta_ff))) * (1 - pFtotal / Kf)
    
    # Croissance du au recrutement allochtone et l'immigration nette (dFallo/dt)
    dFallo  <- ((pBtotal * (sigma * fecondity * zeta * gamma_beta_bf)) + If) * (1 - pFtotal / Kf)
    
    # Croissance totale de l'avant-récif (dB/dt)
    dFtotal <- dFallo + dFauto
    
    
    #2. Sépration de l'équation de la croissance de sous-population après-récif en 3 équations:
    # Croissance du au recrutement autochtone et à la reproduction asexuée (dBauto/dt)
    dBauto  <- (pBtotal * (rb + (sigma * fecondity * zeta * gamma_beta_bb))) * (1 - pBtotal / Kb)
    
    # Croissance du au recrutement allochtone et l'immigration nette (dBallo/dt)
    dBallo  <- ((pFtotal * (sigma * fecondity * zeta * gamma_beta_fb)) + Ib) * (1 - pBtotal / Kb)
    
    # Croissance totale de l'après-récif (dB/dt)
    dBtotal <- dBallo + dBauto
    
    
    list(c(dFallo, dFauto, dFtotal, dBallo, dBauto, dBtotal))
  })
}



# RÉSOLUTION NUMÉRIQUE DU MODÈLE
out <- ode(y = state, times = times, func = model_proportion_forereef, parms = params)
out <- as.data.frame(out)



# GRAPHIQUE
#Mise en forme pour ggplot
plot_data <- out %>%
  select(time, pFallo,pFauto,pFtotal) %>%
  
  #Renommer les paramètres utilisées
  rename(
    Total = pFtotal,
    Allochtone = pFallo,
    Autochtone = pFauto
  ) %>%
  
  #Mettre en pourcentage les valeurs modélisées
  mutate(
    Total = Total*100,
    Allochtone = Allochtone*100,
    Autochtone = Autochtone*100
  ) %>%
  
  pivot_longer(-time, names_to = "Source", values_to = "Value")


#Graphique
ggplot(plot_data, aes(x = time, y = Value, color = Source)) +
  geom_line(size = 1.7) +
  
  #Définition de l'axe des x
  scale_x_continuous(
    breaks = c(1,3,5,7),
    labels= c(2012, 2014, 2016, 2018)
  ) +
  
  #Définition de l'axe des y
  scale_y_continuous(
    limits=c(0,75),
    breaks = c(0, 25, 50, 75)
  ) +
  
  #Définition des couleurs
  scale_color_manual(
    values = c(
      "Total" = "black",
      "Allochtone" = "goldenrod",
      "Autochtone" = "steelblue"  
    )
  ) +
  
  #Définition des titres
  labs(
    title = "Croissance de la sous-population avant-récif corallienne (Pf)",
    x = NULL,
    y = "Couverture corallienne (%)",
    color = NULL
  ) +
  
  theme_minimal(base_size = 14) +
  
  #Ajustement de certains paramètres visuels
  theme(
    legend.position = c(0.05, 0.95),
    legend.justification = c("left","top"),
    legend.text = element_text(size = 16),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    axis.ticks = element_line(color = "black"),
    axis.ticks.length = unit(5, "pt"),
    plot.title = element_text(hjust = 0.5),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  
  #Aligner l'axe des x avec le 0 de l'axe des y
  coord_cartesian(expand = FALSE)

```

<br>

![](Figure 3c.png)
```{r, echo=FALSE}
# ALLER CHERCHER LES PACKAGES NÉCESSAIRES
library(ggplot2)
library(dplyr)
library(tidyr)


# DÉFINITION DES PARAMÈTRES UTILISÉS

#Paramètres de temps
years <- 2011:2018   #Années de l'étude
n <- length(years)

#Paramètre de taille de population
Pf <- seq(0.05, 0.6, length.out = n)   #Population forereef
Pb <- seq(0.2, 0.5, length.out = n)    #Population backreef
Pf[1] <- 0                             #Forcer à commencer à 0
Pb[1] <- 0                             #Force à commencer à 0

#Paramètre de capacité de soutien
Kf <- 0.8            #Capacité de charge de 80%

#Paramètres de reproduction
rf <- 0.12           #Reproduction asexuée 
sigma_f <- 0.05      #Intensité de la croissance larvaire

#Coefficients d'interaction (γβ)
gamma_beta_ff <- seq(0.2, 0.8, length.out = n)   #forereef vers forereef
gamma_beta_bf <- seq(0.01, 0.01, length.out = n) #forereef vers backreef

#Immigration externe (données modélisées)
If <- c(0.0075, 0.0095, 0.0085, 0.008, 0.007, 0.006, 0.005, 0.002)



#Calcul des 4 composantes  de dPf/dt et ajustement selon le facteur de densité-dépendance
#Facteur de densité-dépendance
density_factor <- (1 - Pf / Kf)

#Croissance asexuée
asexual <- Pf * rf
asexual_adj <- asexual * density_factor

#Auto-recrutement (autochtone)
self_recruit <- Pf * sigma_f * gamma_beta_ff
self_recruit_adj <- self_recruit * density_factor

#Échange local
local_exchange <- Pb * sigma_f * gamma_beta_bf
local_exchange_adj <- local_exchange * density_factor

#Immigration nette (allochtone)
immigration <- If 
immigration_adj <- immigration * density_factor



# GRAPHIQUE
#Création du dataframe pour le graphique
df <- data.frame(
  Year = rep(years, 4),
  Component = rep(c("Croissance asexuée", "Auto-recrutement", "Échange local", "Immigration"), each = n),
  Value = c(asexual_adj, self_recruit_adj, local_exchange_adj, immigration_adj)
)

#Mise en forme des données en pourcentage de la capacité de charge par an
df$PercentK <- 100 * df$Value / Kf

#Amplification des courbes pour un meilleur effet visuel
scaling_factor <- 2.5

df$PercentK <- df$PercentK * scaling_factor


#Graphique
ggplot(df, aes(x = Year, y = PercentK, linetype = Component)) +
  geom_smooth(se = FALSE, method = "loess", size = 1.2, color = "black") +
  
  #Définition du type de lignes utilisées
  scale_linetype_manual(
    values = c("solid", "dashed", "dotted", "dotdash"),
    breaks = c("Croissance asexuée", "Immigration", "Auto-recrutement", "Échange local")
  ) +
  
  #Définition de l'axe des y
  scale_y_continuous(
    limits = c(0, 11),
    breaks = c(0, 3, 7, 11)
  )+
  
  #Définition des titres
  labs(
    title = "Composants contribuant aux changements de la croissance de la population",
    y = expression("%K / yr"),
    x = NULL,
    linetype = NULL
  ) +
  
  theme_minimal(base_size = 14) +
  
  #Ajustement de certains paramètres visuels
  theme(
    legend.position = c(0.05, 0.95),
    legend.justification = c("left", "top"),
    legend.text = element_text(size = 16),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    axis.ticks = element_line(color = "black"),
    axis.ticks.length = unit(5, "pt"),
    axis.title.y = element_text(angle = 90, vjust = 0.5),
    plot.title = element_text(hjust = 0.4, face = "bold", size = 10),
    plot.margin = margin(10, 30, 10, 10)
  )+
  
  #Aligner l'axe
  coord_cartesian(expan = FALSE)
```

<br>
<br>

### Après-récif

L'après-récif a aussi été modélisé avec `model_proportion_backreef`, puisque les deux sous-populations réagissent différement aux perturbations. En effet, plutôt que de croître comme la sous-population d'avant-récif, l'arrière-récif a un pourcentage de recouvrement corallien qui diminue. Et bien que l'immigration reste constant et très faible (%K/yr < 0.1), la courbe de mortalité augmente plus les années passent. 


![](Figure 4a.png) 
```{r, echo=FALSE}
# ALLER CHERCHER LES PACKAGES NÉCESSAIRES
library(deSolve)
library(ggplot2)
library(dplyr)
library(tidyr)


# DÉFINITION DES PARAMÈTRES DU MODÈLE
#Différences: ajout de mortalité et changements états initiaux.

params <- list(
  
  #Taux de mortalité du backreef
  mortal <- 0.3,   
  
  #Paramètre de reproduction asexuée
  rb = 0.05,        #Reproduction asexuée de la population backreef
  rf = 0.15,        #Reproduction asecuée de la population forereef
  
  #Paramètre de reproduction sexuée
  sigma = 0.5,    #Intensité de la croissance larvaire 
  fecondity = 1,    #Fécondité
  zeta = 1,         #Probabilité de maturation larvaire
  
  #Coefficients d’interactions (γβ)
  gamma_beta_bb = 0.01,   #Influence de backreef sur backreef
  gamma_beta_fb = 0.002,  #Influence de forereef sur backreef
  gamma_beta_ff = 0.2,    #Influence de forereef sur forereef 
  gamma_beta_bf = 0.1,    #Influence de backreef sur forereef 
  
  #Paramètre d'immigration nette (apport externe constant)
  Ib = 0.08,     #Immigration du backreef (tiré du graphique 4c)
  If = 0.09,     #Immigration du forereef
  
  #Capacités de soutien en proportion
  Kb = 0.64,   #Capacité de soutien du backreef 0.64 dans article (observé)
  Kf = 0.8     #Capacité de soutien du forereef  0.8 dans article
)

#Conditions initiales du modèle
state <- c(pFallo = 0.01, pFauto = 0.01, pFtotal = 0.01, pBallo = 0.3, pBauto = 0.1, pBtotal = 0.4)

#Intervalle de temps en années (2011 à 2018)
times <- seq(0, 7, by = 0.1)





# CRÉATION DU MODÈLE DE CROISSANCE SELON LES ÉQUATIONS 4 DE L'ARTICLE + MORTALITÉ
model_proportion_backreef <- function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    
    # 1. Séparation de l'équation de la croissance de sous-population avant-récif en 3 équations:
    # Croissance du au recrutement autochtone et à la reproduction asexuée (dFauto/dt)
    dFauto  <- (pFtotal * (rf + (sigma * fecondity * zeta * gamma_beta_ff))) * (1 - pFtotal / Kf)
    
    # Croissance du au recrutement allochtone et l'immigration nette (dFallo/dt)
    dFallo  <- ((pBtotal * (sigma * fecondity * zeta * gamma_beta_bf)) + If) * (1 - pFtotal / Kf)
    
    # Croissance totale de l'avant-récif (dB/dt)
    dFtotal <- dFallo + dFauto
    
    
    #2. Sépration de l'équation de la croissance de sous-population après-récif en 3 équations:
    # Croissance du au recrutement autochtone et à la reproduction asexuée (dBauto/dt)
    dBauto  <- (pBtotal * (rb + (sigma * fecondity * zeta * gamma_beta_bb))) * (1 - pBtotal / Kb)
    
    # Croissance du au recrutement allochtone et l'immigration nette (dBallo/dt)
    dBallo  <- ((pFtotal * (sigma * fecondity * zeta * gamma_beta_fb)) + Ib) * (1 - pBtotal / Kb)
    
    # Croissance totale de l'après-récif (dB/dt)
    # Ajout de la mortalité ici
    dBtotal <- dBallo + dBauto - (mortal * pBtotal)
    
    
    list(c(dFallo, dFauto, dFtotal, dBallo, dBauto, dBtotal))
  })
}



# RÉSOLUTION NUMÉRIQUE DU MODÈLE
out <- ode(y = state, times = times, func = model_proportion_backreef, parms = params)
out <- as.data.frame(out)



# GRAPHIQUE
#Ajustement des données en pourcentage
out$pBtotal_pourcentage <- out$pBtotal*100

#graphique qui reproduit la figure 4a
ggplot(out, aes(x = time, y = pBtotal_pourcentage)) +
  geom_line(size = 1.7) +
  
  #Définition de l'axe des x
  scale_x_continuous(
    breaks = c(1,3,5,7),
    labels= c(2012, 2014, 2016, 2018)
  ) +
  
  #Définition de l'axe des y
  scale_y_continuous(
    limits=c(0,50),
    breaks = c(0, 20, 50)
  ) +
  
  #Définition des titres
  labs(
    title = "Couverture corallienne de la sous-population après-récif (Pb)",
    x = NULL,
    y = "Couverture corallienne (%)"
  ) +
  
  theme_minimal(base_size = 14) +
  
  #Ajustement de certains paramètres visuels
  theme(
    legend.position = c(0.80, 0.95),
    legend.justification = c("left","top"),    
    legend.text = element_text(size = 16),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    axis.ticks = element_line(color = "black"),
    axis.ticks.length = unit(5, "pt"),
    plot.title = element_text(hjust = 0.5, size=10),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  
  #Aligner l'axe des x avec le 0 de l'axe des y
  coord_cartesian(expand = FALSE)

```


<br>

![](Figure 4c.png)
```{r, echo=FALSE}
# ALLER CHERCHER LES PACKAGES NÉCESSAIRES
library(ggplot2)
library(dplyr)
library(tidyr)

# DÉFINITION DES PARAMÈTRES UTILISÉS

#Paramètres de temps
years <- 2011:2018   #Années de l'étude
n <- length(years)

# Paramètres de taille de population
Pf <- seq(0.05, 0.6, length.out = n)  #Population forereef
Pb <- seq(0.2, 0.5, length.out = n)   #Population backreef
Pf[1] <- 0                            #Forcer à commencer à 0
Pb[1] <- 0                            #Forcer à commencer à 0

#Paramètre de capacité de soutien
Kb <- 0.8            #Capacité de charge de 80%

#Paramètres de reproduction
rb <- 0.1            #Reproduction asexuée
sigma_f <- 0.05      #Intensité de la croissance larvaire

#Coefficients d'interaction (γβ)
gamma_beta_bb <- seq(0.2, 0.7, length.out = n)  #backreef vers backreef
gamma_beta_fb <- rep(0.01, lenght.out = n)      #forereef vers backreef



# CALCUL DES COMPOSANTES dPb/dt ET AJUSTEMENT SELON LE FACTEUR DE DENSITÉ-DÉPENDANCE
#Facteur de densité-dépendance
density_factor <- (1 - Pb / Kb)

#Croissance asexuée et auto-recrutement (autochtone)
intrinsic <- Pb * (rb + sigma_f * gamma_beta_bb)
intrinsic_adj <- intrinsic * density_factor

#Échange local
exchange <- Pf * sigma_f * gamma_beta_fb
exchange_adj <- exchange * density_factor

#Immigration nette (allochtone)
immigration <- rep(0.0007, n)
immigration_adj <- immigration 

#Variation totale
total_change <- intrinsic_adj + exchange_adj + immigration_adj

#Estimation de la courbe de mortalité
mortalite <- -0.003 + 0.0022 * (years - min(years)) / ((years - min(years)) + 4)



# GRAPHIQUE
#Création du dataframe pour le graphique
df_backreef <- data.frame(
  Year = rep(years, 2),
  Component = rep(c("Immigration", "Mortality"), each = n),
  Value = c(immigration_adj, mortalite)
)


#Mise en forme des données en pourcentage de la capacité de charge par an
df_backreef$PercentKb <- 100 * df_backreef$Value / Kb


#Graphique lissé
ggplot(df_backreef, aes(x = Year, y = PercentKb, linetype = Component)) +
  geom_smooth(se = FALSE, method = "loess", size = 1.2, color = "black") +
  
  #Définition du type de lignes utilisés
  scale_linetype_manual(values = c("Mortality" = "solid", "Immigration" = "dashed")) +
  
  #Définition de l'axe des y
  scale_y_continuous(
    limits = c(-0.4, 0.1),
    breaks = c(-0.4, -0.1, 0.1)
  )+
  
  #Définition des titres
  labs(
    title = "Composants contribuant aux changements de la croissance de la population dans le backreef",
    y = expression("%K / yr"),
    x = NULL,
    linetype = NULL
  ) +
  
  theme_minimal(base_size = 14) +
  
  #Ajustement de certains paramètres visuels
  theme(
    legend.position = c(0.80, 0.20),
    legend.justification = c("left", "top"),
    legend.text = element_text(size = 16),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    axis.ticks = element_line(color = "black"),
    axis.ticks.length = unit(5, "pt"),
    axis.title.y = element_text(angle = 90, vjust = 0.5),
    plot.title = element_text(hjust = 0.5, face = "bold", size = 10),
    plot.margin = margin(10, 30, 10, 10)
  )+
  
  #Aligner l'axe des x avec le 0 de l'axe des y
  coord_cartesian(expan=FALSE)

```

------------------------------------------------------------------------

## **Interprétation biologique**

La présente étude porte sur une métapopulation de coraux de la Polynésie
française. Les chercheurs ont regardé comment la croissance asexuée des
polypes, les populations autochtones, les populations locales et les
populations allochtones influençaient la récupération de la population
après une perturbation.

L'utilisation de différent modèles de dynamique des populations ont permis d'évaluer les différentes importances relatives des facteurs contribuants à la regénérescence d'une sous-population après avoir été fortement perturbée par les étoiles de mers, faisant alors diminuer drastiquement l'abondance de coraux dans les récifs.

La figure 2 nous démontre les différentes trajectoires
non-dimensionnelles de la population. Ce graphique illustre
l’interaction entre l’immigration et l’autorecrutement. Nous pouvons
comprendre que l’immigration, représentée par la ligne jaune, possède
une plus grande influence que la croissance intrinsèque de la
population, représentée par la ligne bleue, en ce qui a trait à la
récupération après une perturbation. Ce graphique représente simplement
un modèle de base, qui nous a permis de créer les autres graphiques pour
répondre à notre question de recherche. Les résultats de ce graphique représentent donc un monde idéaliste où les populations sont identiques et les paramètres invariables dans le temps.

La figure 3a représentent l'évolution d'une sous-population d'avant-récif qui a un fort pour de rétablissement après une population. De manière générale entre les années, le recrutement larvaire allochtone jumelé à l'immigration nette a un plus fort impact que le recrutement larvaire autochtone et la reproduction sexuée. Toutes les composantes influence quand même la croissance de la population.

Toutefois, la figure 3c démontrent l'importance relative de chacun des facteurs (reproduction asexuée, recrutement autochtone, recrutement locale et recrutement allochtone) dans le rétablissement de la population. Au début, c'est l'immigration nette qui a un grand impact sur la repopulation de l'avant-récif, mais il semble qu'une fois que l'abondance s'élève, ce sera plutôt la reproduction asexuée et le recrutement autochtone qui joueront un rôle dans le maintien d'une population croissante. Or, précisément en 2013, la croissance asexuée
des polypes domine largement la récupération, et l’autorecrutement des
populations produites localement surpasse la subvention de
l’immigration. 

Quant à elle, la figure 4a représente une reconstruction de trajectoire de population sur un site de l'après-récif qui est en déclin. Comme il est expliquer dans l'article de Torres et al., il y a une forte compétition entre les coraux et les microalgues dans l'après-récif, ne facilitant donc pas l'augmentation de l'abondance de coraux. 

La figure 4c représente les composants contribuant aux changements de la
croissance de la population, soit l'immigration et un facteur de mortalité constant. 

De plus, étant donné que les différents
habitats sont connectés de manière hydrodynamique, il est probable que
les conditions du récif arrière ne soient pas propices à la fixation et
au recrutement des larves. Comme on peut le remarquer dans différents
graphiques du récif arrière, la couverture corallienne diminue plus le
temps avance jusqu’à se stabiliser, et la mortalité de la population
augmente jusqu’à se stabiliser également. 

Si l’on regarde de manière générale à
travers ces graphiques, nous pouvons voir que l'avant-récif est
beaucoup plus propice à la prolifération asexuée que l'après-récif.
En effet, le récif arrière possède une croissance intrinsèque compensée
par la mortalité où la récupération par les autres populations de coraux
peut être plus difficile, et ce, même avec une certaine subvention des
larves provenant du récif avant. Cette abondance faible de coraux dans l'arrière récif peut donc expliquer en partie pourquoi le recrutement local de larve est si bas dans l'avant-récif, comme on peut le voir dans la figure 3c.